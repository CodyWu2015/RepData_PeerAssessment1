---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r load data}
d <- read.csv(unz("activity.zip", "activity.csv"),header=TRUE,colClass=c("numeric","Date","numeric"))
head(d)
```

## What is mean total number of steps taken per day?

```{r average total per day}
d1 <- aggregate(steps ~ date, data=d, FUN=sum)
summary(d1$steps)
```

So the mean is `r as.character(summary(d1$steps)[4])` and median is `r as.character(summary(d1$steps)[3])`.

Histogram for the total number of steps taken each day is plotted below:
```{r histgram, fig.height=4}
hist(d1$steps, xlab="Number of Steps", main="Total Number of Steps Per Day")
```

## What is the average daily activity pattern?

The time series data of the average number of steps taken for each 5min interval, averaged across all days is generated by:
```{r 5min interval}
d2 <- aggregate(steps ~ interval, d, mean)
head(d2)
```

And plotted with interval start time as x-axis, number of steps taken as y-axis:
```{r plot, fig.height=5}
plot(d2, type="l", main="Average Number of Steps /5m Time Series")
```

Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
```{r max}
ix <- sort(d2$steps,index.return=TRUE,decreasing=TRUE)$ix
d2[ix[1],]
```

So max number of steps `r d2[ix[1],]$steps` occurs at time interval starting at `r d2[ix[1],]$interval`.

## Imputing missing values

There are a number of missing values in the original data.  
We can calculate the number of missing values by:
```{r missing}
sum(is.na(d$steps))
```

So there are in total `r sum(is.na(d$steps))` missing step values.

To workaround the missing values we have adopted a strategy by filling in missing values by the 5min interval average across all days. 
```{r fill missing}
t1 <- merge(d,d2, by="interval")
t2 <- transform(t1, steps=pmax(steps.x, steps.y, na.rm=TRUE))[,-c(2,4)]
head(t2)
```

With the revised new dataset t3 we can redraw the histogram as well as summarize the data to find mean and median:
```{r redraw histogram}
t3 <- aggregate(steps ~ date, data=t2, FUN=sum)
summary(t3$steps)
```

So the new mean is `r as.character(summary(t3$steps)[4])` and new median is `r as.character(summary(t3$steps)[3])`.

And the new histgram looks like:
```{r new histgram,fig.height=4}
hist(t3$steps, xlab="Number of Steps", main="Total Number of Steps Per Day (revised)")
```

And can be seen compared with directly using raw data, the mean and median does get impacted and tends to be bigger.

## Are there differences in activity patterns between weekdays and weekends?

We start by classifying revised data's day type to be either weekday or weekends.
```{r classify}
getDayType <- function(x){
  if(!is.na(match(x, c("Saturday", "Sunday")))) "weekend"
  else "weekday"
}
t2$dayType <- as.factor(sapply(weekdays(t2$date), getDayType))
head(t2)
```

Then we aggregate by weekday and weekend separately:
```{r aggregate}
t2a <- aggregate(steps ~ interval, subset(t2, dayType=="weekend"), mean)
t2b <- aggregate(steps ~ interval, subset(t2, dayType=="weekday"), mean)
head(t2a)
head(t2b)
```
